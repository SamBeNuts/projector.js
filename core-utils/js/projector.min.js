/*
 * projector.js v1.0.0
 *
 * Copyright (C) 2019 Samuel Lager
 */

!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.Projector=t()}(this,function(){"use strict";let e,t="1.0.0",i={body:document.querySelector("body"),slides:document.querySelector(".slides")},o={autoplay:!1,autoplayTiming:4e3,animations:!0,controls:!0,cursorVisible:"auto",cursorVisibleTiming:4e3,defaultBackground:"none",defaultBackgroundOptions:{},defaultTransition:"none",defaultTransitionOptions:{},heightSlide:1080,history:!1,loop:!1,mouseWheel:!0,progress:!0,resizeSlides:!0,selectionEnabled:!0,speakerWindow:!1,widthSlide:1920},s={animationActive:0,autoplayId:null,cursorVisibleTimingId:null,initialized:!1,loaded:!1,nbSlide:0,menu:!0,pause:!1,scale:1,selection:!1,slideActive:-1,userAgent:null},n={en:{pause:'<b>PAUSE</b><br>Press <span class="keybind_white">P</span> to continue',end:'<b>END</b><br>Press <span class="keybind_white">P</span> to restrart',stop_presenting:"STOP PRESENTING",options_title:"Options",fullscreen_option:"Fullscreen",fullscreen_option_info:"Shortcut : F"},fr:{pause:'<b>PAUSE</b><br>Presser <span class="keybind_white">P</span> pour continuer',end:'<b>END</b><br>Presser <span class="keybind_white">R</span> pour revoir',stop_presenting:"ARRÊTER LA PRÉSENTATION",options_title:"Options",fullscreen_option:"Plein écran",resize_option:"Adapter à l'écran",resize_option_info:"Adapte la taille de la diapositive à l'écran tout en conservant le ratio",loop_option:"Lire en boucle",loop_option_info:"Après la dernière diapositive reviens à la première",autoplay_option:"Lecture automatique",autoplay_option_info:"Passe à la diapositive suivante automatiquement",mousewheel_option:"Contrôler avec la molette",mousewheel_option_info:"Permet de contrôler le diaporama avec la molette de la souris",cursor_option:"Cacher le curseur",cursor_option_info:"Désactive le curseur de la souris",selection_option:"Autoriser la sélection",selection_option_info:"Désactive le clic gauche de la souris pour passer à la diapositive suivante",progress_option:"Barre de progression",controls_option:"Afficher les contrôles",shortcuts_title:"Raccourcis",shortcut_fullscreen:"<b>F</b> : Plein écran",shortcut_menu:"<b>M</b> : Menu",shortcut_previous:"<b>Flèche gauche/bas</b> : Diapositive précédente",shortcut_next:"<b>Espace</b>, <b>Flèche droite/haut</b>, <b>Clique gauche</b> : Dispositive suivante",shortcut_pause:"<b>P</b> : Pause",shortcut_restart:"<b>R</b> : Recommencer"}};function l(){o.resizeSlides?(s.scale=Math.min(window.innerHeight/o.heightSlide,window.innerWidth/o.widthSlide),i.slides.style.transform="translate(-50%, -50%) scale("+s.scale+")"):(s.scale=1,i.slides.style.transform="translate(-50%, -50%)")}function r(e,t,o,s,n,l){let r=document.createElement(t);r.classList.add(o);for(let e in s)r.dataset[e]=s[e];return r.innerHTML=n,l?e.insertBefore(r,i.slides):e.appendChild(r),r}function d(e,t,o,s){let n='<div class="checkbox';s&&(n+=" checked"),n+='" id="'+e+'">    <div onclick="'+t+'"></div>    <span data-trad="'+e+'_option"></span></div>',o&&(n+='<p class="info" data-trad="'+e+'_option_info"></p>'),r(i.menu.children[1].children[0],"div","option",null,n,!1)}function c(){s.pause=!s.pause,i.pause.dataset.pause=(!w(i.pause.dataset.pause)).toString()}function a(){s.menu=!s.menu,i.menu.dataset.menu=(!w(i.menu.dataset.menu)).toString()}function u(){S(document.querySelector("#fullscreen")),p()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen()}function p(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function m(){"auto"===o.cursorVisible?(document.addEventListener("mousemove",v,!1),document.addEventListener("mousedown",v,!1)):(i.upperLayer.dataset.cursor=o.cursorVisible,i.upperLayer.dataset.selection=o.selectionEnabled,document.removeEventListener("mousemove",v,!1),document.removeEventListener("mousedown",v,!1))}function v(){i.upperLayer.dataset.cursor="true",i.upperLayer.dataset.selection=o.selectionEnabled,clearTimeout(s.cursorVisibleTimingId),s.cursorVisibleTimingId=setTimeout(function(){i.upperLayer.dataset.cursor="false",i.upperLayer.dataset.selection="false"},o.cursorVisibleTiming)}function g(e){o.autoplay=!o.autoplay,S(e.parentElement),b()}function b(){o.autoplay?s.autoplayId=window.setInterval(E,o.autoplayTiming):(window.clearInterval(s.autoplayId),s.autoplayId=null)}function h(){s.slideActive<=0?(i.controls.firstElementChild.style.visibility="hidden",i.controls.lastElementChild.style.visibility="visible"):s.slideActive===s.nbSlide?(i.controls.firstElementChild.style.visibility="visible",i.controls.lastElementChild.style.visibility="hidden"):(i.controls.firstElementChild.style.visibility="visible",i.controls.lastElementChild.style.visibility="visible")}function f(){i.progress.style.width=s.slideActive/s.nbSlide*100+"%"}function y(){s.slideActive>0&&A(!1)}function E(){s.slideActive<s.nbSlide&&(A(!0),s.slideActive===s.nbSlide&&o.autoplay&&g(document.querySelector("#autoplay").firstElementChild))}function _(e,t){e>=0&&e<s.nbSlide&&e!==s.slideActive&&(s.slideActive!==s.nbSlide?i.slides.children[s.slideActive].style.visibility="hidden":i.end.dataset.end="false",s.slideActive=e,i.slides.children[s.slideActive].style.visibility="visible",o.autoplay&&(g(),g()),h(),f())}function A(e){if(s.slideActive===s.nbSlide-1&&e&&!o.loop)return i.slides.children[s.slideActive].style.visibility="hidden",i.end.dataset.end="true",s.slideActive++,h(),void f();if(s.slideActive===s.nbSlide&&!e)return i.slides.children[s.slideActive-1].style.visibility="visible",i.end.dataset.end="false",s.slideActive--,h(),void f();let t,n,l,r;-1===s.slideActive?(t=-1,n=0,s.slideActive=n):e?(t=s.slideActive,n=s.slideActive!==s.nbSlide-1?s.slideActive+1:0,s.slideActive=n):(t=s.slideActive-1,n=s.slideActive,s.slideActive=t),l=i.slides.children[n].dataset.transition,-1!==t&&(t=i.slides.children[t]),n=i.slides.children[n],void 0===l?e?(-1!==t&&(t.style.visibility="hidden"),n.style.visibility="visible"):(t.style.visibility="visible",n.style.visibility="hidden"):(-1===t&&(t=null),r=JSON.parse(i.slides.children[n].dataset.transitionOptions),window[l].apply(t,n,r,e)),h(),f()}function S(e){e.classList.toggle("checked")}function w(e){if("string"==typeof e){if("null"===e)return null;if("true"===e)return!0;if("false"===e)return!1;if(e.match(/^-?\d*\.\d*$/))return parseFloat(e);if(e.match(/^-?\d*$/))return parseInt(e)}return e}return e={start:function(v){s.initialized||(s.initialized=!0,console.info("v"+t),function(e,t){for(let i in t)e[i]=t[i]}(o,v),s.userAgent=navigator.userAgent,s.nbSlide=i.slides.children.length,i.loading=r(i.body,"div","loading",null,'<div class="lds-ring"><div></div><div></div><div></div><div></div></div>',!0),i.end=r(i.body,"div","end",{end:!1},'<p data-trad="end"></p>',!0),i.backgrounds=r(i.body,"div","backgrounds",null,"",!0),i.upperLayer=r(i.body,"div","upper_layer",{cursor:o.cursorVisible&&"auto"!==o.cursorVisible,selection:o.selectionEnabled},"",!1),i.progress=r(i.body,"div","progress",{progress:o.progress},"",!1),i.controls=r(i.body,"div","controls",{controls:o.controls},'<img src="core-utils/media/projector_controls_icon.png" onclick="Projector.previous()"><img src="core-utils/media/projector_controls_icon.png" onclick="Projector.next()">',!1),i.pause=r(i.body,"div","pause",{pause:s.pause},'<p data-trad="pause"></p>',!1),i.menu=r(i.body,"div","menu",{menu:s.menu},'<div class="top_logo">    <a href="https://www.impart.com"><img src="core-utils/media/logo_negative.png"></a></div><div class="content">    <div class="content_part">        <p class="title" data-trad="options_title"></p>    </div>    <div class="content_part">        <p class="title" data-trad="shortcuts_title"></p>        <p class="shortcut" data-trad="shortcut_fullscreen"></p>        <p class="shortcut" data-trad="shortcut_menu"></p>        <p class="shortcut" data-trad="shortcut_previous"></p>        <p class="shortcut" data-trad="shortcut_next"></p>        <p class="shortcut" data-trad="shortcut_pause"></p>        <p class="shortcut" data-trad="shortcut_restart"></p>    </div></div><div class="bottom_stop" onclick="window.close();">    <p data-trad="stop_presenting"></p></div>',!1),d("fullscreen","Projector.toggleFullscreen();",!1,p()),d("controls","Projector.toggleControls(this);",!1,o.controls),d("mousewheel","Projector.toggleMouseWheel(this);",!0,o.mouseWheel),d("cursor","Projector.toggleCursorVisible(this);",!0,o.cursorVisible),d("selection","Projector.toggleSelection(this);",!0,o.selectionEnabled),d("progress","Projector.toggleProgress(this);",!1,o.progress),d("loop","Projector.toggleLoop(this);",!0,o.loop),d("autoplay","Projector.toggleAutoplay(this);",!0,o.autoplay),d("resize","Projector.toggleResize(this);",!0,o.resizeSlides),window.addEventListener("resize",l,!1),document.addEventListener("keydown",function(e){"F5"!==e.code&&"Escape"!==e.code&&"F11"!==e.code||e.preventDefault()},!1),document.addEventListener("keyup",function(e){"KeyP"===e.code?c():"Semicolon"===e.code?a():"KeyR"===e.code?_(0):"Escape"===e.code||"F5"===e.code||"F11"===e.code||"KeyF"===e.code?u():"ArrowLeft"!==e.code&&"ArrowDown"!==e.code&&"Backspace"!==e.code||s.pause?"ArrowRight"!==e.code&&"ArrowUp"!==e.code&&"Space"!==e.code&&"Enter"!==e.code||s.pause||E():y()},!1),i.upperLayer.addEventListener("mouseup",function(e){0!==e.button&&1!==e.button||s.pause||o.selectionEnabled||E()},!1),document.addEventListener("wheel",function(e){!o.mouseWheel||s.pause||s.menu||(e.deltaY>0?y():e.deltaY<0&&E())},!1),i.slides.style.width=o.widthSlide+"px",i.slides.style.height=o.heightSlide+"px",document.querySelectorAll("[data-trad]").forEach(function(e){e.innerHTML=n[document.documentElement.lang][e.dataset.trad]}),function(){if("none"!==o.defaultTransition){let e;for(let t=0;t<s.nbSlide;t++)void 0===(e=i.slides.children[t].dataset).transition&&(e.transition=o.defaultTransition,e.transitionOptions=o.defaultTransitionOptions)}}(),window.addEventListener("message",function(t){let i=t.data;"string"==typeof i&&"{"===i.charAt(0)&&"}"===i.charAt(i.length-1)&&(i=JSON.parse(i)).method&&"function"==typeof e[i.method]&&e[i.method].apply(e,i.args)},!1),setInterval(function(){0===i.body.scrollTop&&0===i.body.scrollLeft||(i.body.scrollTop=0,i.body.scrollLeft=0)},1e3),m(),h(),f(),l(),function(){let e=document.createElement("img");e.src="core-utils/media/logo_negative.png",e.style.position="absolute",e.style.bottom="20px",e.style.left="50%",e.style.marginLeft="-100px",e.style.width="200px",e.style.height="auto",i.end.appendChild(e)}(),s.loaded=!0,window.addEventListener("load",function(){i.body.removeChild(i.loading),delete i.loading,s.started=!0,b(),E()},!1))},previous:y,next:E,go:_,toggleFullscreen:u,togglePause:c,toggleMenu:a,toggleControls:function(e){o.controls=!o.controls,i.controls.dataset.controls=(!w(i.controls.dataset.controls)).toString(),S(e.parentElement)},toggleMouseWheel:function(e){o.mouseWheel=!o.mouseWheel,S(e.parentElement)},toggleCursorVisible:function(e){o.cursorVisible=e,m()},toggleSelection:function(e){o.selectionEnabled=!o.selectionEnabled,i.upperLayer.dataset.selection=(!w(i.upperLayer.dataset.selection)).toString(),S(e.parentElement)},toggleProgress:function(e){o.progress=!o.progress,i.progress.dataset.progress=(!w(i.progress.dataset.progress)).toString(),S(e.parentElement)},toggleLoop:function(e){o.loop=!o.loop,S(e.parentElement)},toggleAutoplay:g,toggleResize:function(e){o.resizeSlides=!o.resizeSlides,S(e.parentElement),l()},settings:o,selector:i,slidesAttributes:s}});