/*
 * projector.js v1.0.0
 *
 * Copyright (C) 2019 Samuel Lager
 */

!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.Projector=t()}(this,function(){"use strict";let e,t="1.0.0",i={body:document.querySelector("body"),slides:document.querySelector(".slides")},n={autoplay:!1,autoplayTiming:4e3,animations:!0,controls:!0,cursorVisible:"auto",cursorVisibleTiming:4e3,defaultBackground:{},defaultTransition:"none",defaultTransitionOptions:{},heightSlide:1080,history:!1,loop:!1,mouseWheel:!0,progress:!0,resizeSlides:!0,selectionEnabled:!0,speakerWindow:!1,widthSlide:1920},o={animationActive:{},animationIndex:0,animationTimeline:[],autoplayId:null,cursorVisibleTimingId:null,animationTimerActive:{},initialized:!1,loaded:!1,nbSlide:0,menu:!0,pause:!1,scale:1,selection:!1,slideActive:-1,transitionActive:null,userAgent:null},s={en:{pause:'<b>PAUSE</b><br>Press <span class="keybind">P</span> to continue',end:'<b>END</b><br>Press <span class="keybind">P</span> to restrart',stop_presenting:"STOP PRESENTING",options_title:"Options",fullscreen_option:"Fullscreen",fullscreen_option_info:"Shortcut : F"},fr:{pause:'<b>PAUSE</b><br>Presser <span class="keybind">P</span> pour continuer',end:'<b>END</b><br>Presser <span class="keybind">R</span> pour revoir',stop_presenting:"ARRÊTER LA PRÉSENTATION",options_title:"Options",fullscreen_option:"Plein écran",resize_option:"Adapter à l'écran",resize_option_info:"Adapte la taille de la diapositive à l'écran tout en conservant le ratio",loop_option:"Lire en boucle",loop_option_info:"Après la dernière diapositive reviens à la première",autoplay_option:"Lecture automatique",autoplay_option_info:"Passe à la diapositive suivante automatiquement",mousewheel_option:"Contrôler avec la molette",mousewheel_option_info:"Permet de contrôler le diaporama avec la molette de la souris",cursor_option:"Cacher le curseur",cursor_option_info:"Désactive le curseur de la souris",selection_option:"Autoriser la sélection",selection_option_info:"Désactive le clic gauche de la souris pour passer à la diapositive suivante",progress_option:"Barre de progression",controls_option:"Afficher les contrôles",shortcuts_title:"Raccourcis",shortcut_fullscreen:"<b>F</b> : Plein écran",shortcut_menu:"<b>M</b> : Menu",shortcut_previous:"<b>Flèche gauche/bas</b> : Diapositive précédente",shortcut_next:"<b>Flèche droite/haut</b>, <b>Clique gauche</b>, <b>Espace</b> : Dispositive suivante",shortcut_pause:"<b>P</b> : Pause",shortcut_restart:"<b>R</b> : Recommencer"}};function l(){i.body.removeChild(i.loading),delete i.loading,o.started=!0,T(),F()}function a(){n.resizeSlides?(o.scale=Math.min(window.innerHeight/n.heightSlide,window.innerWidth/n.widthSlide),i.slides.style.transform="translate(-50%, -50%) scale("+o.scale+")",i.backgrounds.style.transform="translate(-50%, -50%) scale("+o.scale+")"):(o.scale=1,i.slides.style.transform="translate(-50%, -50%)",i.backgrounds.style.transform="translate(-50%, -50%)")}function r(e,t,n,o,s,l){let a=document.createElement(t);a.classList.add(n);for(let e in o)a.dataset[e]=o[e];return a.innerHTML=s,l?e.insertBefore(a,i.slides):e.appendChild(a),a}function c(e,t,n,o){let s=document.createElement("div");if(s.classList.add("option"),s.appendChild(function(e,t,i){let n=document.createElement("div");n.classList.add("checkbox"),i&&n.classList.add("checked");n.id=e,n.addEventListener("click",t,!1);let o=document.createElement("span");return o.dataset.trad=e+"_option",n.appendChild(o),n.appendChild(document.createElement("div")),n}(e,t,o)),n){let t=document.createElement("p");t.classList.add("info"),t.dataset.trad=e+"_option_info",s.appendChild(t)}i.menu.children[1].children[0].appendChild(s)}function d(e){o.slideActive>=0&&o.slideActive<o.nbSlide&&(e?(i.slides.children[o.slideActive].querySelectorAll(".anim").forEach(function(e){e.style.cssText=e.dataset.style}),o.animationIndex=0):o.animationIndex=o.animationTimeline[o.slideActive].length)}function u(){o.pause=!o.pause,i.pause.dataset.pause=(!W(i.pause.dataset.pause)).toString()}function p(){o.menu=!o.menu,i.menu.dataset.menu=(!W(i.menu.dataset.menu)).toString()}function m(){M(document.querySelector("#fullscreen")),v()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen()}function v(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function f(e){n.controls=!n.controls,i.controls.dataset.controls=(!W(i.controls.dataset.controls)).toString(),M(e.currentTarget)}function g(e){n.mouseWheel=!n.mouseWheel,M(e.currentTarget)}function y(){i.upperLayer.dataset.cursor="true",i.upperLayer.dataset.selection=n.selectionEnabled,clearTimeout(o.cursorVisibleTimingId),o.cursorVisibleTimingId=setTimeout(function(){i.upperLayer.dataset.cursor="false",i.upperLayer.dataset.selection="false"},n.cursorVisibleTiming)}function b(e){n.selectionEnabled=!n.selectionEnabled,i.upperLayer.dataset.selection=(!W(i.upperLayer.dataset.selection)).toString(),M(e.currentTarget)}function h(e){n.progress=!n.progress,i.progress.dataset.progress=(!W(i.progress.dataset.progress)).toString(),M(e.currentTarget)}function A(e){n.loop=!n.loop,M(e.currentTarget)}function E(e){n.autoplay=!n.autoplay,M(e.currentTarget),T()}function T(){n.autoplay?o.autoplayId=window.setInterval(L,n.autoplayTiming):(window.clearInterval(o.autoplayId),o.autoplayId=null)}function _(e){n.resizeSlides=!n.resizeSlides,M(e.currentTarget),a()}function S(){o.slideActive<=0?(i.controls.firstElementChild.classList.add("disabled"),i.controls.lastElementChild.classList.remove("disabled")):o.slideActive===o.nbSlide?(i.controls.firstElementChild.classList.remove("disabled"),i.controls.lastElementChild.classList.add("disabled")):(i.controls.firstElementChild.classList.remove("disabled"),i.controls.lastElementChild.classList.remove("disabled"))}function w(){i.progress.style.transform="scaleX("+o.slideActive/o.nbSlide+")"}function k(){o.slideActive>0&&(null!==o.transitionActive?I(!1):0!==Object.keys(o.animationActive).length||0!==Object.keys(o.animationTimerActive).length?C(!1):o.animationIndex>0?O(!1):q(!1))}function L(){o.slideActive<o.nbSlide?null!==o.transitionActive?I(!0):0!==Object.keys(o.animationActive).length||0!==Object.keys(o.animationTimerActive).length?C(!0):-1!==o.slideActive&&o.animationIndex<o.animationTimeline[o.slideActive].length?O(!0):q(!0):n.autoplay&&E(document.querySelector("#autoplay"))}function x(e,t){if(e>=0&&e<o.nbSlide){let s=!1;e!==o.slideActive&&(-1!==o.slideActive&&o.slideActive!==o.nbSlide?(i.slides.children[o.slideActive].style.display="none",i.backgrounds.children[o.slideActive].style.display="none"):o.slideActive===o.nbSlide&&(i.end.dataset.end="false"),o.slideActive=e,i.slides.children[o.slideActive].style.display="block",i.backgrounds.children[o.slideActive].style.display="block",n.autoplay&&(E(document.querySelector("#autoplay")),E(document.querySelector("#autoplay"))),d(!0),s=!0,S(),w()),t!==o.animationActive&&(s||d(!0),N(t),R(t,!0,!0))}}function F(){let e=new URL(document.location).hash;if(""===e)L();else{let t;t=-1!==e.indexOf("-")?parseInt(e.substring(1,e.indexOf("-"))):parseInt(e.substring(1)),isNaN(t)||t<0?t=0:t>=o.nbSlide&&(t=o.nbSlide-1);let i=parseInt(e.substring(e.indexOf("-")+1));isNaN(i)||i<0?i=0:i>=o.animationTimeline[t].length&&(i=o.animationTimeline[t].length),x(t,i)}}function I(e){cancelAnimationFrame(o.transitionActive[0]),null!==o.transitionActive[1]&&(o.transitionActive[1].style.cssText="",o.transitionActive[3].style.cssText=""),o.transitionActive[2].style.cssText="",o.transitionActive[4].style.cssText="",e===o.transitionActive[5]&&(e?o.slideActive++:o.slideActive--,d(e),S(),w()),o.transitionActive=null,i.slides.children[o.slideActive].style.display="block",i.backgrounds.children[o.slideActive].style.display="block",e&&R(0,!0,!0)}function q(e){if(o.slideActive===o.nbSlide-1&&e&&!n.loop)return i.slides.children[o.slideActive].style.display="none",i.backgrounds.children[o.slideActive].style.display="none",i.end.dataset.end="true",o.slideActive++,d(e),S(),void w();if(o.slideActive===o.nbSlide&&!e)return i.slides.children[o.slideActive-1].style.display="block",i.backgrounds.children[o.slideActive-1].style.display="block",i.end.dataset.end="false",o.slideActive--,d(e),S(),void w();let t,s,l;-1===o.slideActive?(t=-1,s=0,o.slideActive=s):e?(t=o.slideActive,s=o.slideActive!==o.nbSlide-1?o.slideActive+1:0,o.slideActive=s):(t=o.slideActive-1,s=o.slideActive,o.slideActive=t);let a=t,r=s;-1!==t&&(t=i.slides.children[t],a=i.backgrounds.children[a]),s=i.slides.children[s],r=i.backgrounds.children[r],void 0!==(l=s.dataset.transition)?(-1===t&&(t=null,a=null),function(e,t,i,n,s,l,a){if(!D(window[s].opt_to_check,l))return void P(e,t,i,n,!a);if(a){let o=e;e=t,t=o,o=i,i=n,n=o}let r=[],c=window[s].init(e,t,i,n,l,a,r);if(t.style.display="block",n.style.display="block",!c[0])return void P(e,t,i,n,!0);let d,u=performance.now();d=requestAnimationFrame(function p(m){window[s].step(e,t,i,n,l,a,m,u,c[1]);o.transitionActive=null;V(r)?(null!==e&&(e.style.cssText="",i.style.cssText=""),R(0,!0,!0)):(d=requestAnimationFrame(p),o.transitionActive=[d,e,t,i,n,a])}),o.transitionActive=[d,e,t,i,n,a]}(t,s,a,r,l,JSON.parse(s.dataset.transitionOptions),!e)):P(t,s,a,r,e),d(e),S(),w()}function P(e,t,i,n,o){o?(-1!==e&&null!==e&&(e.style.display="none",i.style.display="none"),t.style.display="block",n.style.display="block"):(e.style.display="block",i.style.display="block",t.style.display="none",n.style.display="none")}function C(e){let t,i=!1;for(let n in o.animationTimerActive)clearTimeout(n),i||(t=z(o.animationTimerActive[n],e),i=!0);o.animationTimerActive={};for(let n in o.animationActive)cancelAnimationFrame(o.animationActive[n][0]),o.animationActive[n][2].style.cssText=o.animationActive[n][2].dataset.style,i||(t=z(o.animationActive[n][1],e),i=!0);o.animationActive={},N(t)}function O(e){e||o.animationIndex--;let t=o.animationTimeline[o.slideActive][o.animationIndex];e&&o.animationIndex++,void 0!==t?(j(o.animationIndex,t.targetId,t.animation,t.options,!e,t.delay),R(o.animationIndex,e,!1)):!e&&-1===o.animationIndex&&o.slideActive>0&&q(!1)}function R(e,t,i){if(e<o.animationTimeline[o.slideActive].length){let n=o.animationTimeline[o.slideActive][e];"sync"!==n.trigger||i?"after"===n.trigger&&i&&O(t):O(t)}}function z(e,t){let i=o.animationTimeline[o.slideActive],n=1;for(t||(n=-1);e>=0&&e<i.length&&"click"!==i[e].trigger;)e+=n;return e}function N(e){if(-1===e)x(o.slideActive-1,o.animationTimeline[o.slideActive-1].length);else{let t=o.animationTimeline[o.slideActive];for(let i=0;i<e;i++){let e=t[i],n=[],o=document.querySelector('[data-object-id="'+e.targetId+'"]');window[e.animation].init(o,e.options,!1,n);for(let e=0;e<n.length;e++)n[e][0].style[n[e][1]]=n[e][2];o.style.visibility="visible"}o.animationIndex=e}}function j(e,t,i,n,s,l){if(!D(window[i].opt_to_check,n))return;let a=[],r=document.querySelector('[data-object-id="'+t+'"]'),c=window[i].init(r,n,s,a);if(r.style.visibility="visible",!c[0])return;let d,u,p=performance.now(),m=0;function v(t){window[i].step(r,n,s,t,p,c[1]),delete o.animationActive[d],V(a)?(u=setTimeout(function(){R(e,!s,!0),delete o.animationTimerActive[u]},m),o.animationTimerActive[u]=e):(d=requestAnimationFrame(v),o.animationActive[d]=[d,e,r,s])}L||(m=l,l=0),u=setTimeout(function(){d=requestAnimationFrame(v),o.animationActive[d]=[d,e,r,s],delete o.animationTimerActive[u]},l),o.animationTimerActive[u]=e}function V(e){for(let t=0;t<e.length;t++)if(null!==e[t][0]&&e[t][0].style[e[t][1]]!==e[t][2])return!1;return!0}function D(e,t){for(let i=0;i<e.length;i++)if(void 0===t[e[i]])return!1;return!0}function M(e){e.classList.toggle("checked")}function W(e){if("string"==typeof e){if("null"===e)return null;if("true"===e)return!0;if("false"===e)return!1;if(e.match(/^-?\d*\.\d*$/))return parseFloat(e);if(e.match(/^-?\d*$/))return parseInt(e)}return e}let B={doEasing:function(e,t,i,n,o,s){if(t-i<0)t=i;else if(t-i>1.02*n)return s;let l=(s-o)*B.easing[e]((t-i)/n)+o;return l>s&&t-i>.98*n?s:l},easing:{linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return 1-B.easing.easeInQuad(1-e)},easeInOutQuad:function(e){return e<.5?2*B.easing.easeInQuad(e):1-2*B.easing.easeInQuad(1-e)}}};return e={start:function(d){o.initialized||(o.initialized=!0,console.info("v"+t),function(e,t){for(let i in t)e[i]=t[i]}(n,d),o.userAgent=navigator.userAgent,o.nbSlide=i.slides.children.length,i.loading=r(i.body,"div","loading",null,'<div class="lds-ring"><div></div><div></div><div></div><div></div></div>',!0),i.end=r(i.body,"div","end",{end:!1},'<p data-trad="end"></p>',!0),i.backgrounds=r(i.body,"div","backgrounds",null,"",!0),i.upperLayer=r(i.body,"div","upper_layer",{cursor:n.cursorVisible&&"auto"!==n.cursorVisible,selection:n.selectionEnabled},"",!1),i.progress=r(i.body,"div","progress",{progress:n.progress},"",!1),i.controls=r(i.body,"div","controls",{controls:n.controls},'<img src="core-utils/media/projector_controls_icon.png" onclick="Projector.previous()"><img src="core-utils/media/projector_controls_icon.png" onclick="Projector.next()">',!1),i.pause=r(i.body,"div","pause",{pause:o.pause},'<p data-trad="pause"></p>',!1),i.menu=r(i.body,"div","menu",{menu:o.menu},'<div class="top_logo">    <a href="https://www.impart.com"><img src="core-utils/media/logo_negative.png"></a></div><div class="content">    <div class="content_part">        <p class="title" data-trad="options_title"></p>    </div>    <div class="content_part">        <p class="title" data-trad="shortcuts_title"></p>        <p class="shortcut" data-trad="shortcut_fullscreen"></p>        <p class="shortcut" data-trad="shortcut_menu"></p>        <p class="shortcut" data-trad="shortcut_previous"></p>        <p class="shortcut" data-trad="shortcut_next"></p>        <p class="shortcut" data-trad="shortcut_pause"></p>        <p class="shortcut" data-trad="shortcut_restart"></p>    </div></div><div class="bottom_stop" onclick="window.close();">    <p data-trad="stop_presenting"></p></div><div class="open_close_btn" onclick="Projector.toggleMenu()">   <img src="core-utils/media/projector_controls_icon.png"></div>',!1),c("fullscreen",m,!1,v()),c("controls",f,!1,n.controls),c("mousewheel",g,!0,n.mouseWheel),c("selection",b,!0,n.selectionEnabled),c("progress",h,!1,n.progress),c("loop",A,!0,n.loop),c("autoplay",E,!0,n.autoplay),c("resize",_,!0,n.resizeSlides),window.addEventListener("resize",a,!1),window.addEventListener("hashchange",F,!1),document.addEventListener("keydown",function(e){"F5"!==e.code&&"Escape"!==e.code&&"F11"!==e.code||e.preventDefault()},!1),document.addEventListener("keyup",function(e){"KeyP"===e.code?u():"Semicolon"===e.code?p():"KeyR"===e.code?x(0,0):"Escape"===e.code||"F5"===e.code||"F11"===e.code||"KeyF"===e.code?m():"ArrowLeft"!==e.code&&"ArrowDown"!==e.code&&"Backspace"!==e.code||o.pause?"ArrowRight"!==e.code&&"ArrowUp"!==e.code&&"Space"!==e.code&&"Enter"!==e.code||o.pause||L():k()},!1),i.upperLayer.addEventListener("mouseup",function(e){0!==e.button&&1!==e.button||o.pause||n.selectionEnabled||L()},!1),document.addEventListener("wheel",function(e){!n.mouseWheel||o.pause||o.menu||(e.deltaY>0?k():e.deltaY<0&&L())},!1),i.slides.style.width=n.widthSlide+"px",i.slides.style.height=n.heightSlide+"px",i.backgrounds.style.width=n.widthSlide+"px",i.backgrounds.style.height=n.heightSlide+"px",document.querySelectorAll("[data-trad]").forEach(function(e){let t=s[document.documentElement.lang][e.dataset.trad];e.innerHTML=void 0!==t?t:s.en[e.dataset.trad]}),function(){let e=i.slides.children,t=i.backgrounds;if(void 0!==n.defaultBackground.type)for(let t=0;t<o.nbSlide;t++)void 0===e[t].dataset.background&&(e[t].dataset.background=JSON.stringify(n.defaultBackground));for(let i=0;i<e.length;i++){let n=document.createElement("div");if(n.classList.add("background"),void 0!==e[i].dataset.background){let t=JSON.parse(e[i].dataset.background);if("color"===t.type){let e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor=t.value,n.appendChild(e)}}t.appendChild(n)}}(),function(){if("none"!==n.defaultTransition)for(let e=0;e<o.nbSlide;e++){let t=i.slides.children[e].dataset;void 0===t.transition&&(t.transition=n.defaultTransition,t.transitionOptions=JSON.stringify(n.defaultTransitionOptions))}}(),function(){let e=i.slides.children;for(let t=0;t<e.length;t++)if(void 0!==e[t].dataset.animation){let i=e[t].dataset.animation.split("|");i.forEach(function(e,t,i){i[t]=JSON.parse(e)}),o.animationTimeline.push(i)}else o.animationTimeline.push([]);document.querySelectorAll(".anim").forEach(function(e){e.dataset.style=e.style.cssText})}(),window.addEventListener("message",function(t){let i=t.data;"string"==typeof i&&"{"===i.charAt(0)&&"}"===i.charAt(i.length-1)&&(i=JSON.parse(i)).method&&"function"==typeof e[i.method]&&e[i.method].apply(e,i.args)},!1),setInterval(function(){0===i.body.scrollTop&&0===i.body.scrollLeft||(i.body.scrollTop=0,i.body.scrollLeft=0)},1e3),"auto"===n.cursorVisible?(document.addEventListener("mousemove",y,!1),document.addEventListener("mousedown",y,!1)):(i.upperLayer.dataset.cursor=n.cursorVisible,i.upperLayer.dataset.selection=n.selectionEnabled,document.removeEventListener("mousemove",y,!1),document.removeEventListener("mousedown",y,!1)),S(),w(),a(),function(){let e=document.createElement("img");e.src="core-utils/media/logo_negative.png",e.style.position="absolute",e.style.bottom="20px",e.style.left="50%",e.style.marginLeft="-100px",e.style.width="200px",e.style.height="auto",i.end.appendChild(e)}(),o.loaded=!0,window.addEventListener("load",function(){setTimeout(l,100)},!1))},previous:k,next:L,go:x,toggleFullscreen:m,togglePause:u,toggleMenu:p,toggleControls:f,toggleMouseWheel:g,toggleSelection:b,toggleProgress:h,toggleLoop:A,toggleAutoplay:E,toggleResize:_,Anime:B,settings:n,selector:i,slidesAttributes:o}});